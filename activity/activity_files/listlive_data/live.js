STK.register("common.editor.getLength",function(a){return function(b){var c=41,d=140,e=20,f=b,g=b.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}});
STK.register("kit.dom.cssText",function(a){var b=function(a,b){var c=(a+";"+b).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4"),d;while(c&&(d=c.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i)))c=c.replace(d[1]+d[2]+d[3],"");return c};return function(a){a=a||"";var c=[],d={push:function(a,b){c.push(a+":"+b);return d},remove:function(a){for(var b=0;b<c.length;b++)c[b].indexOf(a+":")==0&&c.splice(b,1);return d},getStyleList:function(){return c.slice()},getCss:function(){return b(a,c.join(";"))}};return d}});
STK.register("common.listener",function(a){var b={},c={};c.define=function(c,d){if(b[c]!=null)throw"common.listener.define: 频道已被占用";b[c]=d;var e={};e.register=function(d,e){if(b[c]==null)throw"common.listener.define: 频道未定义";a.listener.register(c,d,e)};e.fire=function(d,e){if(b[c]==null)throw"commonlistener.define: 频道未定义";a.listener.fire(c,d,e)};e.remove=function(b,d){a.listener.remove(c,b,d)};e.cache=function(b){return a.listener.cache(c,b)};return e};return c});
STK.register("kit.dom.isTurnoff",function(a){return function(a){return!a.parentNode||a.parentNode.nodeType==11||!!a.disabled}});
STK.register("kit.extra.textareaUtils",function(a){var b={},c=document.selection;b.selectionStart=function(a){if(!c)try{return a.selectionStart}catch(b){return 0}var d=c.createRange(),e,f,g=0,h=document.body.createTextRange();h.moveToElementText(a);for(g;h.compareEndPoints("StartToStart",d)<0;g++)h.moveStart("character",1);return g};b.selectionBefore=function(a){return a.value.slice(0,b.selectionStart(a))};b.selectText=function(a,b,d){a.focus();if(!c)a.setSelectionRange(b,d);else{var e=a.createTextRange();e.collapse(1);e.moveStart("character",b);e.moveEnd("character",d-b);e.select()}};b.insertText=function(a,d,e,f){a.focus();f=f||0;if(!c){var g=a.value,h=e-f,i=h+d.length;a.value=g.slice(0,h)+d+g.slice(e,g.length);b.selectText(a,i,i)}else{var j=c.createRange();j.moveStart("character",-f);j.text=d}};b.replaceText=function(a,d){a.focus();var e=a.value,f=b.getSelectedText(a),g=f.length;if(f.length==0)b.insertText(a,d,b.getCursorPos(a));else{var h=b.getCursorPos(a);if(!c){var j=h+f.length;a.value=e.slice(0,h)+d+e.slice(h+g,e.length);b.setCursor(a,h+d.length);return}var i=c.createRange();i.text=d;b.setCursor(a,h+d.length)}};b.getCursorPos=function(a){var b=0;if(STK.core.util.browser.IE){a.focus();var d=null;d=c.createRange();var e=d.duplicate();e.moveToElementText(a);e.setEndPoint("EndToEnd",d);a.selectionStart=e.text.length-d.text.length;a.selectionEnd=a.selectionStart+d.text.length;b=a.selectionStart}else if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart;return b};b.getSelectedText=function(a){var b="",d=function(a){return a.selectionStart!=undefined&&a.selectionEnd!=undefined?a.value.substring(a.selectionStart,a.selectionEnd):""};window.getSelection?b=d(a):b=c.createRange().text;return b};b.setCursor=function(a,b,c){b=b==null?a.value.length:b;c=c==null?0:c;a.focus();if(a.createTextRange){var d=a.createTextRange();d.move("character",b);d.moveEnd("character",c);d.select()}else a.setSelectionRange(b,b+c)};b.unCoverInsertText=function(a,b,c){c=c==null?{}:c;c.rcs=c.rcs==null?a.value.length:c.rcs*1;c.rccl=c.rccl==null?0:c.rccl*1;var d=a.value,e=d.slice(0,c.rcs),f=d.slice(c.rcs+c.rccl,d==""?0:d.length);a.value=e+b+f;this.setCursor(a,c.rcs+(b==null?0:b.length))};return b});
STK.register("module.at",function(a){var b=window,c=document,d=a.core.util.browser,e="font-family:Tahoma,宋体;",f=a.kit.extra.textareaUtils.selectionStart,g,h,i,j,k,l=function(){var a={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":(navigator.userAgent.match(/.+(?:ie) ([\d.]+)/i)||[8])[1]<8?['<pre style="overflow:hidden;display:inline;',e,'word-wrap:break-word;"> </pre>'].join(""):['<span style="white-space:pre-wrap;',e,'"> </span>'].join("")};return function(b){var c=b.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(b){return a[b]});return c}}(),m=function(){var b=[],c=g.textEl.style.cssText,d;a.foreach(["margin","padding","border"],function(c){a.foreach(["Top","Left","Bottom","Right"],function(d){var e;c!="border"?e=b.push(c,"-",d.toLowerCase(),":",a.getStyle(g.textEl,c+d),";"):a.foreach(["Color","Style","Width"],function(e){b.push(c,"-",d.toLowerCase(),"-",e.toLowerCase(),":",a.getStyle(g.textEl,[c,d,e].join("")),";")})})});b.push("font-size:"+a.getStyle(g.textEl,"fontSize")+";");return a.kit.dom.cssText([c,b.join(""),e,"word-wrap: break-word;line-height: 18px;overflow-y:auto;overflow-x:hidden;outline:none;"].join("")).getCss()},n=function(){var b=a.builder(['<div node-type="wrap" style="display:none;">','<span node-type="before"></span>','<span node-type="flag"></span>','<span node-type="after"></span>',"</div>"].join("")).list,e=b.wrap[0],f=b.flag[0],h=b.after[0],i=b.before[0],j=0,n,o,p,q=function(a){return d.MOZ?-2:d.MOBILE&&d.SAFARI&&(d.IPAD||d.ITOUCH||d.IPHONE)?-2:0};return{bind:function(){if(o!==g.textEl){k=a.position(g.textEl);var b=["left:",k.l,"px;top:",k.t+20,"px;"].join("");o=g.textEl;var d=m();o.style.cssText=d;p=[b,d,"position:absolute;filter:alpha(opacity=0);opacity:0;z-index:-1000;"].join("");e.style.cssText=p;if(!j){j=1;c.body.appendChild(e)}}},content:function(b,c,d,j){e.style.cssText=[p,"width:",(o.offsetWidth||parseInt(a.getStyle(o,"width")))+q(),"px;height:",o.offsetHeight||parseInt(a.getStyle(o,"height")),"px;overflow-x:hidden;overflow-y:",/webkit/i.test(navigator.userAgent)?"hidden":a.getStyle(o,"overflowY"),";"].join("");i.innerHTML=l(b);f.innerHTML=l(c)||"&thinsp;";h.innerHTML=l([d,j].join(""));clearTimeout(n);n=setTimeout(function(){var b=a.position(f);a.custEvent.fire(g.eId,"at",{t:b.t-o.scrollTop-k.t+5,l:b.l-k.l+5,key:d,flag:c,textarea:g.textEl})},30)},hide:function(){e.style.display="none"},show:function(){e.style.display=""}}}(),o=function(){if(a.kit.dom.isTurnoff(g.textEl))clearInterval(h);else{var b=g.textEl.value.replace(/\r/g,""),c=f(g.textEl);if(c<0||c==j)return;j=c;var d=b.slice(0,c),e=d.match(new RegExp(["(",g.flag,")([a-zA-Z0-9一-龥_]{0,20})$"].join("")));if(!e){a.custEvent.fire(g.eId,"hidden");return}var i=b.slice(c);d=d.slice(0,-e[0].length);n.content(d,e[1],e[2],i)}};return function(b){if(!!b&&!!b.textEl){b=a.parseParam({textEl:null,flag:"@",eId:a.custEvent.define({},["at","hidden"])},b);var c=function(){if(!!g){clearInterval(h);a.removeEvent(g.textEl,"blur",c);n.hide()}},d=function(){c();g=b;j=null;n.bind();n.show();h=setInterval(o,200);a.addEvent(b.textEl,"blur",c)};a.addEvent(b.textEl,"focus",d);return b.eId}}});
STK.register("kit.extra.merge",function(a){return function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}});
STK.register("core.str.trim",function(a){return function(a){if(typeof a!="string")throw"trim need a string as parameter";var b=a.length,c=0,d=/(\u3000|\s|\t|\u00A0)/;while(c<b){if(!d.test(a.charAt(c)))break;c+=1}while(b>c){if(!d.test(a.charAt(b-1)))break;b-=1}return a.slice(c,b)}});
STK.register("core.json.jsonToQuery",function(a){var b=function(b,c){b=b==null?"":b;b=a.core.str.trim(b.toString());return c?encodeURIComponent(b):b};return function(a,c){var d=[];if(typeof a=="object")for(var e in a){if(e==="$nullName"){d=d.concat(a[e]);continue}if(a[e]instanceof Array)for(var f=0,g=a[e].length;f<g;f++)d.push(e+"="+b(a[e][f],c));else typeof a[e]!="function"&&d.push(e+"="+b(a[e],c))}return d.length?d.join("&"):""}});
STK.register("common.log.monitor",function(a){var b="http://www.weibojs.com/log/widget.php",c={refer:document.referrer,title:document.title,ua:window.navigator.userAgent,os:window.navigator.platform+"|"+window.navigator.oscpu},d=!0,e=function(a){var b=new Image;d&&(b.src=a);b=null};return function(d){var f={},g=a.kit.extra.merge(c,d),h=[];for(var i in g){var j=g[i];typeof j=="object"&&(j=a.core.json.jsonToQuery(j));h.push(i+"="+encodeURIComponent(j))}var k=b+"?"+h.join("&");e(k);f.monitor=e;return f}});
STK.register("kit.io.ajax",function(a){return function(b){var c,d,e,f,g,h,i,j=function(b){a.common.log.monitor({url:document.location.protocol+"//"+document.location.hostname+(c.url.charAt(0)=="/"?c.url:"/"+c.url),param:c.args,method:c.method,result:b&&(b.code||0),httpcode:f.status})};h=function(a){g=!1;b.onComplete(a,c.args);setTimeout(k,0)};i=function(a){g=!1;b.onFail&&b.onFail(a,c.args);j(a);setTimeout(k,0)};e=[];f=null;g=!1;c=a.parseParam({url:"",method:"get",responseType:"json",timeout:3e4,onTraning:a.funcEmpty,isEncode:!0},b);c.onComplete=h;c.onFail=i;var k=function(){if(!!e.length){if(g===!0)return;g=!0;c.args=e.shift();f=a.ajax(c)}},l=function(a){while(e.length)e.shift();g=!1;if(f)try{f.abort()}catch(b){}f=null};d={};d.request=function(a){a||(a={});b.noQueue&&l();if(!b.uniqueRequest||!f){e.push(a);a._t=0;k()}};d.abort=l;return d}});
STK.register("kit.io.jsonp",function(a){return function(b){var c,d,e,f,g;c=a.parseParam({url:"",method:"get",responseType:"json",varkey:"_v",timeout:3e4,onComplete:a.funcEmpty,onTraning:a.funcEmpty,onFail:a.funcEmpty,isEncode:!0},b);e=[];f={};g=!1;var h=function(){if(!!e.length){if(g===!0)return;g=!0;f.args=e.shift();f.onComplete=function(a){g=!1;c.onComplete(a,f.args);setTimeout(h,0)};f.onFail=function(a){g=!1;c.onFail(a);setTimeout(h,0)};a.jsonp(a.kit.extra.merge(c,{args:f.args,onComplete:function(a){f.onComplete(a)},onFail:function(a){try{f.onFail(a)}catch(b){}}}))}};d={};d.request=function(a){a||(a={});e.push(a);a._t=1;h()};d.abort=function(a){while(e.length)e.shift();g=!1;f=null};return d}});
STK.register("kit.io.inter",function(a){return function(){var b,c,d;b={};c={};d={};b.register=function(a,b){if(c[a]!==undefined)throw a+" interface has been registered";c[a]=b;d[a]={}};b.hookComplete=function(b,c){var e=a.core.util.getUniqueKey();d[b][e]=c;return e};b.removeHook=function(a,b){d[a]&&d[a][b]&&delete d[a][b]};b.getTrans=function(b,e){var f=a.kit.extra.merge(c[b],e);f.onComplete=function(a,c){try{e.onComplete(a,c)}catch(f){}if(a.code==="100000")try{e.onSuccess(a,c)}catch(f){}else try{e.onError(a,c)}catch(f){}for(var g in d[b])try{d[b][g](a,c)}catch(f){}};return c[b].requestMode==="jsonp"?a.kit.io.jsonp(f):c[b].requestMode==="ijax"?a.kit.io.ijax(f):a.kit.io.ajax(f)};b.request=function(b,e,f){var g=a.core.json.merge(c[b],e);g.onComplete=function(a,c){try{e.onComplete(a,c)}catch(f){}if(a.code==="100000")try{e.onSuccess(a,c)}catch(f){}else try{if(a.code==="100002"){window.location.href=a.data;return}e.onError(a,c)}catch(f){}for(var g in d[b])try{d[b][g](a,c)}catch(f){}};g=a.core.obj.cut(g,["noqueue"]);g.args=f;return c[b].requestMode==="jsonp"?a.jsonp(g):c[b].requestMode==="ijax"?a.ijax(g):a.ajax(g)};return b}});
STK.register("common.trans.editor",function(a){var b=location.host=="widget.weibo.com"||location.host=="dev.weibo.com"?"":"/widget",c=a.kit.io.inter(),d=c.register;d("face",{url:b+"/public/aj_getemotions.php"});d("at",{url:b+"/public/aj_atusers.php"});return c});
STK.register("module.suggest",function(a){var b=null,c=a.custEvent,d=c.define,e=c.fire,f=c.add,g=a.addEvent,h=a.removeEvent,i=a.stopEvent,j=[],k={},l={ENTER:13,ESC:27,UP:38,DOWN:40,TAB:9},m=function(b){var c=-1,j=[],k=b.textNode,m=b.uiNode,n=a.core.evt.delegatedEvent(m),o=d(k,["open","close","indexChange","onSelect","onIndexChange","onClose","onOpen","openSetFlag"]);o.setFlag=p;var p=function(a){b.flag=a},q=function(){return a.sizzle(["[action-type=",b.actionType,"]"].join(""),m)},r=function(){c=-1;h(k,"keydown",s);n.destroy()},s=function(a){var d,f;if(!!(d=a)&&!!(f=d.keyCode)){if(f==l.ENTER){i();e(o,"onSelect",[c,k,b.flag]);return!1}if(f==l.UP){i();var g=q().length;c=c<1?g-1:c-1;e(o,"onIndexChange",[c]);return!1}if(f==l.DOWN){i();var g=q().length;c=c==g-1?0:c+1;e(o,"onIndexChange",[c]);return!1}if(f==l.ESC){i();r();e(o,"onClose");return!1}if(f==l.TAB){r();e(o,"onClose");return!1}}},t=function(c){e(o,"onSelect",[a.core.arr.indexOf(c.el,q()),k,b.flag])},u=function(b){c=a.core.arr.indexOf(b.el,q());e(o,"onIndexChange",[a.core.arr.indexOf(b.el,q())])};f(o,"open",function(a,c){k=c;r();g(c,"keydown",s);n.add(b.actionType,"mouseover",u);n.add(b.actionType,"click",t);e(o,"onOpen",[b.flag])});f(o,"openSetFlag",function(a,b){p(b)});f(o,"close",function(){r();e(o,"onClose",[b.flag])});f(o,"indexChange",function(a,d){c=d;e(o,"onIndexChange",[c,b.flag])});return o},n=function(b){var c=b.textNode,d=a.core.arr.indexOf(c,j);if(!k[d]){j[d=j.length]=c;k[d]=m(b)}return k[d]};return function(c){if(!!c.textNode&&!!c.uiNode){c=a.parseParam({textNode:b,uiNode:b,actionType:"item",actionData:"index",flag:""},c);return n(c)}}});
STK.register("common.channel.at",function(a){var b=["open","close"];return a.common.listener.define("common.channel.at",b)});
STK.register("kit.extra.language",function(a){window.$LANG||(window.$LANG={});return function(b,c){var d=a.core.util.language(b,$LANG);d=d.replace(/\\}/ig,"}");c&&(d=a.templet(d,c));return d}});
STK.register("kit.dom.firstChild",function(a){var b=a.core.dom.next;return function(a){var c=a.firstChild;c&&c.nodeType!=1&&(c=b(c));return c}});
STK.register("kit.dom.layoutPos",function(a){return function(b,c,d){if(!a.isNode(c))throw"kit.dom.layerOutElement need element as first parameter";if(c===document.body)return!1;if(!c.parentNode)return!1;if(c.style.display==="none")return!1;var e,f,g,h,i,j,k;e=a.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},d);f=c;if(!f)return!1;while(f!==document.body){f=f.parentNode;if(f.style.display==="none")return!1;j=a.getStyle(f,"position");k=f.getAttribute("layout-shell");if(j==="absolute"||j==="fixed")break;if(k==="true"&&j==="relative")break}f.appendChild(b);g=a.position(c,{parent:f});h={w:c.offsetWidth,h:c.offsetHeight};i=e.pos.split("-");i[0]==="left"?b.style.left=g.l+e.offsetX+"px":i[0]==="right"?b.style.left=g.l+h.w+e.offsetX+"px":i[0]==="center"&&(b.style.left=g.l+h.w/2+e.offsetX+"px");i[1]==="top"?b.style.top=g.t+e.offsetY+"px":i[1]==="bottom"?b.style.top=g.t+h.h+e.offsetY+"px":i[1]==="middle"&&(b.style.top=g.t+h.h/2+e.offsetY+"px");return!0}});
STK.register("common.editor.plugin.at",function(a){var b=a.kit.extra.language,c='<div class="WB_tips_smart WB_email"><p class="tipsmt_title" node-type="suggestTitle">想用@提到谁</p><ul class="tipsmt_list" node-type="suggestWrap"></ul></div>',d={"@":{normalTitle:b("#L{选择昵称或轻敲空格完成输入}"),moreTitle:b("#L{选择最近@的人或直接输入}"),noTilte:b("#L{轻敲空格完成输入}")},"#":{normal:b("#L{想用什么话题？}")}},e={"@":'<#et temp data><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="tipsmt_cur" </#if>action-data="value=${list.nickname}" value="${list.nickname}"><a href="#">${list.nickname}<#if (list.remark)>(${list.remark})</#if></a></li><#if (list.count)><span>${list.count}</span></#if></#list></#et>',"#":'<#et temp data><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.topic}" value="${list.topic}"><a href="#">${list.topic}<#if (list.count)>(${list.count})</#if></a></li></#list></#et>'},f,g,h,i,j,k,l,m=!1,n,o,p={"@":"at","#":"topicList"},q=0,r=function(){setTimeout(function(){a.custEvent.fire(f,"close")},200)},s=function(){k.style.display="none"},t=function(){a.custEvent.add(f,"onIndexChange",function(a,b){y(b)});a.custEvent.add(f,"onSelect",function(b,c,d,e){q=0;a.core.evt.stopEvent();var g=o[c].getAttribute("value");g=g.replace(/\(.*\)/,"");try{d.focus()}catch(h){}var i=a.kit.extra.textareaUtils.selectionStart(d)*1,j=new RegExp(e+"([a-zA-Z0-9一-龥_]{0,20})$"),k=d.value.replace(/\r+/g,"").slice(0,i).match(j),l=d.value.slice(i,i+1);k=k&&k[1]?k[1].length:0;var m=a.kit.extra.textareaUtils;e=="#"?typeof l!="undefined"&&l!=e&&(g=g+e+" "):g=g+" ";m.insertText(d,g,i,k);var n=m.getCursorPos(d);if(e=="#"&&l==e){m.setCursor(d,n+1);m.insertText(d," ",n+1,0)}n=m.getCursorPos(d);var p=m.getSelectedText(d),r=p==""||p==null?0:p.length;d.setAttribute("range",n+"&"+r);a.custEvent.fire(f,"close")});a.addEvent(h.textEl,"blur",r);a.custEvent.add(f,"onClose",s);a.custEvent.add(f,"onOpen",function(b,c){j.style.display="";k.style.display="";m=!0;setTimeout(function(){a.custEvent.fire(f,"indexChange",0)},100)})},u=function(b,c,f){b=="@"?c.data&&c.data.length>0?c.title=f==""?d[b].moreTitle:d[b].normalTitle:c.title=d[b].noTilte:c.title=d[b].normalTitle;var g=a.core.util.easyTemplate(e[b],c);return g},v=function(){a.core.evt.custEvent.add(g,"hidden",function(b,c){a.custEvent.fire(f,"close")});a.core.evt.custEvent.add(g,"at",function(b,c){l=c.key;var e=c.flag;if(l.length==0&&e!="@")a.custEvent.fire(f,"close");else{var g=document.location.host=="widget.weibo.com"?"":"/widget";a.core.io.ajax({url:g+"/public/aj_atusers.php",args:{wsrc:$CONFIG.wsrc||"app_comment_box",appkey:$CONFIG.source_appkey||$CONFIG.appkey||$CONFIG.app_src,q:l},onComplete:function(b){if(b.code=="100000"){var g=u(e,b,l);a.custEvent.fire(f,"openSetFlag",e);a.custEvent.fire(f,"open",c.textarea);var h=a.core.dom.builder(g),m=h.box;j.innerHTML=m;j.style.display=b.data.length==0?"none":"";i.innerHTML=l.length==0?d["@"].moreTitle:d["@"].normalTitle;k.style.cssText=["z-index:11001;background-color:#ffffff;position:absolute;"].join("");a.common.channel.at.fire("open");a.kit.dom.layoutPos(k,c.textarea,{pos:"left-top",offsetX:c.l,offsetY:c.t})}else a.custEvent.fire(f,"close")},onFail:function(){a.custEvent.fire(f,"close")}})}})},w=function(){n=h.textEl;g=STK.module.at({textEl:n,flag:"@"})},x=function(b){q=0;k&&(k.style.display="none");k&&(k.innerHTML="");var d=a.builder(c);k=a.kit.dom.firstChild(d.box);k.style.display="none";document.body.appendChild(k);i=d.list.suggestTitle[0];j=d.list.suggestWrap[0];f&&a.custEvent.fire(f,"close");f&&a.custEvent.remove(f);f=a.module.suggest({textNode:b,uiNode:j,actionType:"item",actionData:"value",flag:"@"});t()},y=function(b){o=a.sizzle("li",j);o&&o[0]&&a.core.dom.removeClassName(o[q],"tipsmt_cur");a.core.dom.addClassName(o[b],"tipsmt_cur");q=b};return function(a,b){h=a.nodeList;var c={};c.init=function(){w();x(h.textEl);v()};return c}});
STK.register("common.editor.simpleEditorNew",function(a){var b=a.core.str.trim,c,d=a.common.editor.getLength,e=function(a,b){var c=d(a),e=Math.abs(b-c),f;c>b||c<1?f={wordsnum:c,vnum:e,overflow:!0}:c==0?f={wordsnum:c,vnum:e,overflow:!0}:f={wordsnum:c,vnum:e,overflow:!1};return f};return function(d,f){f=f||{};var g=f.limit||140;if(!d)throw"[easyEditor]: editor is null";a.custEvent.define(d,"textNum");a.custEvent.define(d,"keyUpCount");var h=a.sizzle('[node-type="editor"]',d)[0],i=a.sizzle('[node-type="wordNum"]',d)[0];if(f.atSwitch!=null&&f.atSwitch==!0){var j=a.common.editor.plugin.at({nodeList:{textEl:h}},f);j.init()}a.addEvent(h,"focus",function(){c=setInterval(function(){k()},200)});a.addEvent(h,"blur",function(){c&&clearInterval(c)});var k=function(){var c=b(h.value).length==0?b(h.value):h.value;c=c.replace(/\r\n/g,"\n");var j=e(c,g);c.length>=0&&h.focus?j.overflow&&j.wordsnum!=0?i.className=f.warnClassName?f.warnClassName:"WB_tipS_numWarn":i.className=f.className?f.className:"WB_tipS_num":c.length===0&&(i.className=f.className?f.className:"WB_tipS_num");c.length!==0&&j.overflow?i.innerHTML="-"+(j.vnum>100?"n":j.vnum):i.innerHTML=j.wordsnum;a.custEvent.fire(d,"textNum",{count:j.wordsnum,isOver:j.overflow})};a.addEvent(h,"keyup",k);a.custEvent.add(d,"keyUpCount",k);k()}});
typeof scope=="undefined"&&(scope={});scope.loginKit=function(){if(window.scope){var a=window.scope.current_user_weibo||window.scope.current_user_sina;if(a)return{uid:a,isLogin:!!a}}if(window.$CONFIG){var a=window.$CONFIG.current_user_weibo||window.$CONFIG.current_user_sina||window.$CONFIG.uid;if(a)return{uid:a,isLogin:!!a}}var b=document.cookie+";",c=["SUP","=([^;]*)?;"].join(""),d=["(\\?|&)","uid","=([^&]*)(&|$)"].join(""),e=b.match(new RegExp(c,"i"));e=e?e[1]||"":"";e=unescape(e);var a=e.match(new RegExp(d));a=a?a[2]||"":"";var f=scope.$oid;return{uid:a,isLogin:!!a,isAdmin:a&&f&&a==f}};scope.$isLogin=function(){return scope.loginKit().isLogin};scope.$isAdmin=function(){return scope.loginKit().isAdmin};
STK.register("common.editor.flashContent",function(a){return function(a,b,c,d){b=b||["#fee","#fdd","#fcc","#fdd","#fee","transparent"];c=c||2;d=d||50;var e=0,f=b.length,g=c*f,h=setInterval(function(){a.style.backgroundColor=b[e%f];e++;e==g&&clearInterval(h)},d)}});
STK.register("common.trans.live",function(a){var b=a.kit.io.inter(),c=b.register,d="";location.host!="widget.weibo.com"&&(d="/widget");c("addmblog",{url:d+"/livestream/addmblog.php",method:"post"});c("comment",{url:d+"/livestream/comment.php",method:"post"});c("repost",{url:d+"/livestream/repost.php",method:"post"});c("oldfromsearch",{url:d+"/livestream/getoldfromsearch.php ",method:"get"});c("relations",{url:d+"/livestream/aj_getrelations.php",method:"post"});c("addFollow",{url:d+"/livestream/aj_attention.php",method:"post"});return b});
STK.register("module.tabs",function(a){return function(b,c){function n(b,c){f=c.callback;h=c.className;j=c.defaultIndex;d=typeof c.tabNode=="string"?a.sizzle(c.tabNode,b):c.tabNode;i=d.length;c.boxNode!==""&&(e=typeof c.boxNode=="string"?a.sizzle(c.boxNode,b):c.boxNode);m();for(var g=0;g<i;g++)a.addEvent(d[g],c.evtType,function(b){return function(){a.preventDefault();l(b)}}(g))}function m(){if(!a.isArray(d))throw"module.tab needs tabNode as Array!";if(k.boxNode!==""){if(!a.isArray(e))throw"module.tab needs tabNode as Array!";if(d.length!=e.length)throw"module.tab needs tabNode'length equal to boxNode'length!"}}function l(b){if(b!=j){var c=a.isArray(f)?f[b]:f,g=d[b],i=a.isArray(e)?e[b]:null;if(i){a.setStyle(e[j],"display","none");a.setStyle(e[b],"display","")}a.removeClassName(d[j],h);a.addClassName(d[b],h);c({index:b,tabNode:g,boxNode:i});j=b}}var d,e,f,g,h,i,j,k=a.parseParam({evtType:"click",tabNode:"",boxNode:"",className:"current",callback:function(){},defaultIndex:0},c);n(b,k)}});
STK.register("common.diy.live",function(a){return function(b,c,d,e){var f={},g=function(d){d=d||a.getEvent(d);var f=d.target||d.srcElement,g=a.sizzle(c,b),h=g.length;while(h--)if(g[h]==f||a.contains(g[h],f)){e.call(g[h],d);break}},h=function(){i()},i=function(){a.addEvent(b,d,g)};f.destroy=function(){a.removeEvent(b,d,g);b=null};h();return f}});
STK.register("kit.dom.parseDOM",function(a){return function(a){for(var b in a)a[b]&&a[b].length==1&&(a[b]=a[b][0]);return a}});
STK.register("common.editor.simpleEditor",function(a){var b=a.core.str.trim,c,d=a.common.editor.getLength,e=function(a,b){var c=d(a),e=Math.abs(b-c),f;c>b||c<1?f={wordsnum:c,vnum:e,overflow:!0}:c==0?f={wordsnum:c,vnum:e,overflow:!0}:f={wordsnum:c,vnum:e,overflow:!1};return f};return function(d,f){f=f||{};var g=f.limit||140;if(!d)throw"[easyEditor]: editor is null";a.custEvent.define(d,"textNum");a.custEvent.define(d,"keyUpCount");var h=a.sizzle('[node-type="editor"]',d)[0],i=a.sizzle('[node-type="wordNum"]',d)[0];if(f.atSwitch!=null&&f.atSwitch==!0){var j=a.common.editor.plugin.at({nodeList:{textEl:h}},f);j.init()}a.addEvent(h,"focus",function(){c=setInterval(function(){k()},200)});a.addEvent(h,"blur",function(){c&&clearInterval(c)});var k=function(){var c=b(h.value).length==0?b(h.value):h.value;c=c.replace(/\r\n/g,"\n");var j=e(c,g);c.length>=0&&h.focus?j.overflow&&j.wordsnum!=0?i.className=f.warnClassName?f.warnClassName:"WB_tipS_numWarn":i.className=f.className?f.className:"WB_tipS_num":c.length===0&&(i.className=f.className?f.className:"WB_tipS_num");c.length!==0&&j.overflow?i.innerHTML="-"+(j.vnum>100?"n":j.vnum):i.innerHTML=j.vnum;a.custEvent.fire(d,"textNum",{count:j.wordsnum,isOver:j.overflow})};a.addEvent(h,"keyup",k);a.custEvent.add(d,"keyUpCount",k);k()}});
STK.register("common.widget.showEditor",function(a){var b=a.kit.extra.language,c=a.addEvent,d=a.common.editor.getLength,e=a.common.editor.flashContent,f=a.removeEvent,g={focus:!0,type:"repost",template:'<#et temp data><div class="liveStream_mainFeed_list_comment" style="display:block;" node-type="outer"><div class="liveStream_mainFeed_listArrow W_bgcolor_arrow" style="margin-right:47px;" node-type="arrow"><em class="liveStream_mainFeed_listArrowArrline">◆</em><span>◆</span></div><div class="liveStream_mainFeed_list_commentInput" node-type="publisher"><div class="commentInput_area"><textarea class="WB_textarea" node-type="editor">${data.text}</textarea><p class="commentInput_state" style="display:none;" node-type="error"><span class="WB_tipS_err commentInput_state_icon"></span><span node-type="tip_error">#L{发表微博失败}</span><a href="###" node-type="back">#L{返回}</a></p><p class="commentInput_state" style="display:none;" node-type="success"><span class="WB_tipS_ok commentInput_state_icon"></span><span node-type="tip_success">#L{发布成功}</span></p></div><div class="commentInput_action clearfix"><div class="commentInput_actionRetweet"><p class="commentInput_actionRe"><input type="checkbox" node-type="check" id="checkIt" /><label for="checkIt" node-type="more">#L{同时评论}</label></p></div><div class="commentInput_actionButton"><p class="commentInput_actionSub"><a href="###" class="WB_btnA" node-type="sendBtn"><span>#L{转发}</span></a></p><p class="commentInput_actionFont"><span class="txt_num" node-type="wordNum">140</span>#L{字}</p></div></div></div></div></#et>',forward:"",uname:"",callback:function(){}};return function(h,i){var j,k,l,m={},n="";g=a.parseParam(g,i);if(h&&typeof h=="string")h=a.E(h);else if(h.nodeType!==1)throw"[common.widget.showEditor] node.nodeType wrong!";var o={text:""};if(g.type==="repost"){g.uname=decodeURIComponent(g.uname);var p=g.forward?"//@"+g.uname+"："+decodeURIComponent(g.forward||""):"";o.text=p}var q=function(c){g=a.parseParam(g,c);if(g.type==="comment"){l.more.innerHTML=b("#L{同时转发}");l.sendBtn.innerHTML=b("<span>#L{评论}</span>");l.editor.value=decodeURIComponent(g.forward)}},r=function(){var b=a.trim(l.editor.value),c=d(b);if(c>140||c===0){e(l.editor);return!1}var f=l.check.checked;typeof g.callback=="function"&&g.callback.call(m,b,f)},s=function(){u();v();t()},t=function(){h.parentNode.appendChild(k.box);l=a.kit.dom.parseDOM(a.builder(h.parentNode).list);g.focus&&a.kit.extra.textareaUtils.setCursor(l.editor,0,0);a.common.editor.simpleEditor(l.publisher,{warnClassName:"txt_num err_num",className:"txt_num"})},u=function(){j=a.core.util.easyTemplate(b(g.template),o).toString();k=a.core.dom.builder(j);l=a.kit.dom.parseDOM(k.list)},v=function(){if(g.type==="comment"){l.more.innerHTML=b("#L{同时转发}");l.sendBtn.innerHTML=b("<span>#L{评论}</span>")}c(l.back,"click",w);c(l.sendBtn,"click",r);a.core.evt.hotKey.add(l.editor,"ctrl+Enter",r)},w=function(){l.error.style.display="none";l.editor.value=n};m.showError=function(a){a&&(l.tip_error.innerHTML=a);l.error.style.display="";n=l.editor.value;l.editor.value="";setTimeout(function(){l&&(l.error.style.display="none")},3e3)};m.clear=function(){n="";l.editor.value=""};m.showSuccess=function(a){a&&(l.tip_success.innerHTML=a);m.clear();l.success.style.display="";setTimeout(function(){l&&(l.success.style.display="none")},3e3)};m.setArrow=function(a){l.arrow.style.marginRight=a+"px"};m.getNodes=function(){return l};m.show=t;m.hide=function(a){if(!!l){l.outer.style.display="none";a&&this.destroy()}};m.focus=function(b){a.kit.extra.textareaUtils.setCursor(l.editor,b,0)};m.destroy=function(){f(l.back,"click",w);f(l.sendBtn,"click",r);a.core.evt.hotKey.remove(l.editor,"ctrl+Enter",r);a.removeNode(l.outer);for(var b in l)l[b]=null;l=null};s();m.reInit=q;m.pubNodes=l;return m}});
STK.register("core.obj.parseParam",function(a){return function(a,b,c){var d,e={};b=b||{};for(d in a){e[d]=a[d];b[d]!=null&&(c?a.hasOwnProperty[d]&&(e[d]=b[d]):e[d]=b[d])}return e}});
STK.register("common.widget.log",function(a){var b={app_sharebutton:1,app_followbutton:2,app_livestream:4,app_listweibo:5,app_weiboshow:6,app_commentbox:7};return function(c){var d=a.core.obj.parseParam({vsrc:"app_weiboshow",refer:"",step:1},c),e=scope.refer||scope.$refer||d.refer,f=scope.loginKit().uid||"",g=scope.appkey||$CONFIG.$appkey||$CONFIG.appkey||0,h=b[d.vsrc]||"",i="http://rs.sinajs.cn/r.gif?uid="+f+"&appid="+g+"&refer="+e+"&cat="+h+"&step="+d.step+"&rnd="+ +(new Date),j=new Image;j.src=i;j=null}});
STK.register("common.widget.login",function(a){var b={vsrc:"app_weiboshow",appsrc:"",showlogo:0,callback:function(){}};typeof App=="undefined"&&(App={});return function(c){c=a.parseParam(b,c);c.appsrc||(c.appsrc=scope?scope.appsrc?scope.appsrc:scope.$appsrc?scope.$appsrc:"":"");var d={};App.loginBackUrlCallBack=function(b){a.custEvent.fire(d,"login",b);c.step=2;a.common.widget.log(c)};var e=function(){f();g();h();i()},f=function(){},g=function(){},h=function(){a.custEvent.define(d,"login")},i=function(){a.custEvent.add(d,"login",function(a){c.callback(a)})};d.showLogin=function(){var b="&"+a.jsonToQuery(c),d=navigator.userAgent.indexOf("360 Aphone Browser")>=0,e=/micromessenger\/(\d+\.\d+\.\d+)/i.test(navigator.userAgent);if(d||e)location.href="http://service.weibo.com/reg/loginindex.php?regbackurl=http%3A%2F%2Fweibo.com&backurl="+encodeURIComponent(location.href)+b+"&rnd="+ +(new Date).valueOf();else{var f="http://service.weibo.com/reg/loginindex.php?regbackurl=http%3A%2F%2Fweibo.com&backurl=http%3A%2F%2F"+location.host+"%2Fstaticjs%2FloginProxy.html"+b+"&rnd="+ +(new Date).valueOf();/weibo.com/.test(location.host)&&(f=f.replace(/\/widget/,""));var g=window.open(f,"miniblog_login",["toolbar=1,status=0,resizable=1,width=620,height=540,left=",(screen.width-620)/2,",top=",(screen.height-450)/2].join(""));g.focus();a.common.widget.log(c)}};e();return d}});
STK.register("comp.widget.live.repost_comm",function(a){var b=a.common.diy.live,c=a.kit.extra.language,d=a.common.editor.getLength,e=a.common.widget.showEditor,f=a.addEvent,g=a.common.editor.flashContent,h=a.common.trans.live,i,j,k=function(b,d,e,f,g){var j=arguments;if(!scope.loginKit().isLogin){var m=a.common.widget.login({vsrc:"app_livestream",appsrc:scope.appsrc});a.custEvent.add(m,"login",function(){k.apply(this,j)});m.showLogin()}var n={content:d+(scope.refer_content?scope.refer_content:""),issync:e?1:0,mid:g.mid,appkey:scope.appkey,language:scope.$language,refer:scope.refer,srcuid:g.srcuid},o;f=="repost"&&(n.com_content=g.forward);o=h.getTrans(f,{onComplete:function(a){switch(a.code){case"A00006":i.showSuccess(c("#L{发布成功}"));l(b);break;case"M01155":i.showError(a.msg||c("#L{不要太贪心哦！你已经发过一次啦。}"));break;default:i.showError(a.msg||c("#L{发微博失败，请稍后再试！}"))}}});o.request(n)},l=function(a){var b=a.innerHTML;/\((\d+)\)/.test(b)?b=b.replace(/(\d+)/,+RegExp.$1+1):b+="(1)";a.innerHTML=b},m=0,n="",o=function(b,c){c=c||"repost";var d=b.getAttribute("data");d=a.queryToJson(d);if(d.mid===m&&n===c){if(i&&i.hide){m=0;n="";i.hide(!0);i=null}}else{m=d.mid;n=c;var f=a.E("mid"+d.mid),g={uname:d.uname,type:c,callback:function(a,e){k(b,a,e,c,d)},forward:d.forward};if(i&&i.hide){i.hide(!0);i=null}i=e(f,g);var h=a.position(b),j=a.core.dom.getSize(b),l=a.position(f),o=a.core.dom.getSize(f),p=o.width-j.width/2-(h.l-l.l)-10;i.setArrow(p)}};return function(c){var d={},e,f,g=function(){i()},h=function(){},i=function(){e=b(c,'[node-type="repost"]',"click",function(b){a.stopEvent(b);o(this,"repost");return!1});f=b(c,'[node-type="comment"]',"click",function(b){a.stopEvent(b);o(this,"comment");return!1})},j=function(){f.destroy();e.destroy()};g();d.destroy=j;return d}});
STK.register("comp.widget.live.style",function(a){var b=function(){var b=!1;window.attachEvent&&window.attachEvent("onload",function(){b=!0});return function(c){function d(){var b=document.createElement("style");b.type="text/css";if(a.IE)b.styleSheet.cssText=c;else{var d=document.createDocumentFragment();d.appendChild(document.createTextNode(c));b.appendChild(d)}document.getElementsByTagName("head")[0].appendChild(b)}!a.IE||b?d():window.attachEvent("onload",function(){b=!0;d()})}}(),c=scope.$url_params||location.href,d=function(){var d="",e=/colordiy=(\d+)/.test(c)?RegExp.$1:0,f=/color=([A-Fa-f\d,]+)/.test(c)?RegExp.$1:"";if(f&&e==1){f=f.split(",");f[0]&&(d+="\n .liveStream * ,\n\t\t    .liveStream .liveStream_vline,\n\t\t    .liveStream .liveStream_topborder,\n\t\t    .liveStream .liveStream_topborder p,\n\t\t    .liveStream .liveStream_followList_have{border-color:#"+f[0]+";}");f[1]&&(d+="\n .liveStream .liveStream_topborder, .liveStream .liveStream_title,.liveStream .liveStream_main_tab li a,.liveStream .liveStream_mainFeed_list_commentInput {background:#"+f[1]+";}");f[2]&&(d+="\n .liveStream, .liveStream .liveStream_main_tab li.current a,\n.liveStream .commentInput_action .commentInput_actionFont .txt_num,\n.liveStream .commentInput_actionFont{color:#"+f[2]+";}");f[3]&&(d+="\n .liveStream a,.liveStream .liveStream_main_feedMore a,\n\t\t    .liveStream .WB_linkA a,.liveStream .WB_linkB a,.liveStream .WB_linkB,\n\t\t    .liveStream .WB_linkA{color:#"+f[3]+";}");f[4]&&(d+="\n .liveStream .liveStream_main_height{background:#"+f[4]+";}\n\t\t    \t.liveStream .liveStream_main_tab li.current a {background:#"+f[4]+";}");if(f[5]){d+="\n .liveStream .liveStream_publishbox {background:#"+f[5]+";}";d+="\n .liveStream .liveStream_main_header {background:#"+f[5]+";}";d+="\n .liveStream .liveStream_main_feedMore a{background-color:#"+f[5]+";}";d+="\n .liveStream .liveStream_mainFeed_list:hover, .liveStream .liveStream_mainFeed_list_focus, .liveStream .liveStream_main_allList:hover, .liveStream .liveStream_main_allList_focus, .liveStream .liveStream_follow{background:#"+f[5]+";}"}}var g=/border=(\d+)/.test(c)?RegExp.$1:1;g==0&&(a.E("pl_live").className="WB_widgets liveStream liveStream_noborder");var h=/titlebar=(\d+)/.test(c)?RegExp.$1:1;h==0&&(d+="\n .liveStream_title_top{display:none;}");d&&b(d)},e=function(){var b=/height=(\d+)/.test(c)?parseInt(RegExp.$1):500;b=b>800?800:b<75?75:b;var d=/border=(\d+)/.test(c)?RegExp.$1:1;d!=0&&(b-=2);var e=/titlebar=(\d+)/.test(c)?RegExp.$1:1;e!=0?b-=30:b-=1;var f=/publish=(\d+)/.test(c)?RegExp.$1:1;f!=0?b-=101:b-=30;a.E("pl_live_fans")&&(b-=100);b=Math.max(b,0);a.E("live_content").style.height=b+"px";var g=a.sizzle(".liveStream_main_errorBox");if(g.length)for(var h=0,i=g.length;h<i;h++)g[h].style.height=b+"px"};return function(a,b){var c={},f=function(){d();e()},g=function(){};f();c.destroy=g;return c}});
STK.register("comp.widget.live.loadmore",function(a){var b=function(a){var b=[],c=a.length;for(var d=0;d<c;d++)b.push(a[d]);return b};scope.page={search:2,list:2};var c=a.foreach,d=!1,e=a.kit.extra.language,f=scope.$url_params||location.href,g=function(a,b){return a.getElementsByTagName(b)},h,i,j=[],k=3e4,l=location.host=="widget.weibo.com"?"":"/widget",m=[{url:l+"/livestream/getnewfromsearch.php",oldurl:l+"/livestream/getoldfromsearch.php",topic:scope.topic||-1,mid:scope.mid,delmid:"",type:"search",pic:/pic=0/.test(f)?"0":1,start:20},{url:l+"/livestream/getlistnewfromlist.php",oldurl:l+"/livestream/getlistoldfromlist.php",sinceid:scope.sinceid,uid:scope.listuid,mid:scope.mid,type:"list",maxid:scope.maxid,pic:/pic=0/.test(f)?"0":1,listid:scope.listid||-1}];scope.loadtimeInterval?k=scope.loadtimeInterval:/ltime=(\d+)/.test(f)&&(k=parseInt(RegExp.$1));/atalk=0/.test(f)&&(m[0]=m[1]);scope.$spr=scope.$spr||"";var n=function(b,c,d){var f=0,g=!1,h=m[d];if(h.topic===-1||h.listid===-1)c.style.display="none";else{c.style.display="";a.addEvent(c,"click",function(){if(!g){g=!0;c.innerHTML=e("#L{加载中...}");var d={spr:scope.$spr,start:a.sizzle("div.liveStream_mainFeed_list",b).length-scope.pubCount,uid:scope.listuid,language:$CONFIG.$language,appkey:scope.appkey,refer:scope.refer,dup:scope.$dup,antispan:scope.$antispam,isOutTopicSearch:scope.$isOutTopicSearch,dpc:1};"maxid topic mid listid pic sinceid uid".replace(/\S+/g,function(a){h[a]&&(d[a]=h[a])});typeof h.delmid!="undefined"&&(d.delmid=scope.delMids.join(","));d.page=scope.page[h.type];a.ajax({url:h.oldurl,args:d,onComplete:function(i){if(i.code=="A00008"){c.innerHTML=e("#L{没有更多微博了}");setTimeout(function(){a.removeNode(c)},3e3)}else if(i.code==="A00006"){g=!1;if(i.html){var j=a.C("DIV");j.innerHTML=i.html;var k=a.sizzle("div.liveStream_mainFeed_list",j);b.insertBefore(j,c.parentNode)}i.maxid&&(h.maxid=i.maxid);c.innerHTML=e("#L{点击查看更多}");f>=2&&a.removeNode(c);d.page=scope.page[h.type]++;f++}else c.innerHTML=e("#L{加载出错，点击重试}")},onFail:function(a){g=!1;c.innerHTML=e("#L{加载出错，点击重试}")}})}})}},o=function(c,e){var f=m[e];if(f.topic!==-1&&f.listid!==-1){j[e]=[];var g=function(){var d=m[e],f={spr:scope.$spr,dpc:1,appkey:scope.appkey,refer:scope.refer,language:$CONFIG.$language};"sinceid topic mid uid pic listid maxid".replace(/\S+/g,function(a){d[a]&&(f[a]=d[a])});typeof d.delmid!="undefined"&&(f.delmid=scope.delMids.join(","));d.uid&&(f.start=a.sizzle("div.liveStream_mainFeed_list",c).length-scope.pubCount);f.url_random=0;var g=function(c){"sinceid mid".replace(/\S+/g,function(a){c[a]&&(d[a]=c[a])});if(c.delmid){var f=scope.delMids;scope.delMids=[];for(var g=f.length,h=0;h<g;h++)-1!==a.core.arr.indexOf(f[g],c.delmid)&&scope.delMids.push(f[g])}if(c.html){var k=document.createDocumentFragment(),l=a.C("DIV");l.innerHTML=c.html;setTimeout(function(){var c=a.sizzle("div.liveStream_mainFeed_list",l);j[e]=b(c);i()},0)}else i()},h=function(a){i()};a.ajax({url:d.url,args:f,onComplete:g,onFail:h})},h=function(){var b=j[e].pop();if(c.style.display!=="none"){c.insertBefore(b,c.firstChild);a.comp.widget.live.slidedown(b);setTimeout(function(){i()},2e3)}},i=function(){if(c.style.display=="none"||d)setTimeout(function(){i()},30);else{if(j[e].length===0)return;h()}};setTimeout(function(){i()},3e3)}};return function(b,d){var e={},f=function(){if(!!a.E("tabs")&&!!a.E("live_content")){var b=a.sizzle('[node-type="box"]',a.E("live_content")),d=a.sizzle("div.liveStream_main_feedMore > a",a.E("live_content"));b=[b[0],b[1]];setTimeout(function(){c(b,function(a,b){if(!!a){o(a,b);d[b]&&n(a,d[b],b)}})},0)}},g=function(){},h=function(){};f();e.destroy=h;return e}});
STK.register("common.diy.slider",function(a){var b=a.addEvent,c=a.core.dom.getStyle;setStyle=a.core.dom.setStyle;return function(d,e){if(!d)throw"it need node for slider";var f={},g=function(){function s(b,c){var d=o;switch(b){case"next":o=d>=n?g.continuous?0:n:o+1;break;case"prev":o=o<=0?g.continuous?n:0:o-1;break;case"first":o=0;break;case"last":o=n;break;default:}var e=a.core.ani.tween(i),f;if(!g.vertical){f=o*l*g.step*-1;e.play({marginLeft:f})}else{f=o*m*-1;e.play({marginTop:f})}if(g.controlsFade)if(o==0){p=!1;a.removeClassName(h.prevBtn,"page_ok");a.addClassName(h.nextBtn,"page_ok")}else if(o==n){p=!1;a.addClassName(h.prevBtn,"page_ok");a.removeClassName(h.nextBtn,"page_ok")}else{p=!0;a.addClassName(h.prevBtn,"page_ok");a.addClassName(h.nextBtn,"page_ok")}r.set(o);(c||!p)&&clearTimeout(t);g.auto&&(p||g.continuous)&&(t=setTimeout(function(){s(b,!1)},g.speed+g.pause))}var f={step:1,speed:1e3,show:3,auto:!0,pause:2e3,dir:"left",vertical:!1,continuous:!0,controlsFade:!0},g=a.parseParam(f,e),h={};h.prevBtn=d.prev;h.nextBtn=d.next;h.slider=d.slider;h.btnlist=[];var i=h.slider.getElementsByTagName("ul")[0],j=i.getElementsByTagName("li"),k=j.length,l=j[0].offsetWidth+parseInt(c(j[0],"marginLeft"))+parseInt(c(j[0],"marginRight")),m=j[0].offsetHeight+parseInt(c(j[0],"marginTop"))+parseInt(c(j[0],"marginBottom")),n=Math.floor((k-g.show)/g.step),o=0,p=!0;setStyle(h.slider,"overflow","hidden");setStyle(i,"width",k*l+"px");if(!g.vertical)for(var q=0;q<k;q++)setStyle(j[q],"float","left");b(h.prevBtn,"click",function(){s("prev",!0)});b(h.nextBtn,"click",function(){s("next",!0)});var r={set:function(b){if(h.btnlist.length!==0){for(var c=0;c<h.btnlist.length;c++)a.removeClassName(h.btnlist[c],"current");a.addClassName(h.btnlist[b],"current")}},add:function(){var b=Math.floor(k/g.show);for(var c=0;c<b;c++){var d=a.C("a");d.href="javascript:;";d.innerHTML=parseInt(c+1);d.onclick=function(a){return function(){r.scroll(a)}}(c)}},scroll:function(a){var b="next";if(a!==o){if(a<o){o=a+1;b="prev"}else o=a-1;s(b,!1)}}};if(!(k/g.show>=2)){setStyle(h.prevBtn,"display","none");setStyle(h.nextBtn,"display","none")}var t;g.auto&&(t=setTimeout(function(){s("next",!1)},g.pause));if(g.controlsFade){a.removeClassName(h.prevBtn,"page_ok");a.addClassName(h.nextBtn,"page_ok");r.set(0)}},h=function(){g()};h();f.slider=g;return f}});
STK.register("module.layer",function(a){var b=function(a){var b={};if(a.style.display=="none"){a.style.visibility="hidden";a.style.display="";b.w=a.offsetWidth;b.h=a.offsetHeight;a.style.display="none";a.style.visibility="visible"}else{b.w=a.offsetWidth;b.h=a.offsetHeight}return b},c=function(c,d){d=d||"topleft";var e=null;if(c.style.display=="none"){c.style.visibility="hidden";c.style.display="";e=a.core.dom.position(c);c.style.display="none";c.style.visibility="visible"}else e=a.core.dom.position(c);if(d!=="topleft"){var f=b(c);if(d==="topright")e.l=e.l+f.w;else if(d==="bottomleft")e.t=e.t+f.h;else if(d==="bottomright"){e.l=e.l+f.w;e.t=e.t+f.h}}return e};return function(d){var e=a.core.dom.builder(d),f=e.list.outer[0],g=e.list.inner[0],h=a.core.dom.uniqueID(f),i={},j=a.core.evt.custEvent.define(i,"show");a.core.evt.custEvent.define(j,"hide");var k=null;i.show=function(){f.style.display="";a.core.evt.custEvent.fire(j,"show");return i};i.hide=function(){f.style.display="none";a.custEvent.fire(j,"hide");return i};i.getPosition=function(a){return c(f,a)};i.getSize=function(a){if(a||!k)k=b.apply(i,[f]);return k};i.html=function(a){a!==undefined&&(g.innerHTML=a);return g.innerHTML};i.text=function(b){text!==undefined&&(g.innerHTML=a.core.str.encodeHTML(b));return a.core.str.decodeHTML(g.innerHTML)};i.appendChild=function(a){g.appendChild(a);return i};i.getUniqueID=function(){return h};i.getOuter=function(){return f};i.getInner=function(){return g};i.getParentNode=function(){return f.parentNode};i.getDomList=function(){return e.list};i.getDomListByKey=function(a){return e.list[a]};i.getDom=function(a,b){return e.list[a]?e.list[a][b||0]:!1};i.getCascadeDom=function(b,c){return e.list[b]?a.core.dom.cascadeNode(e.list[b][c||0]):!1};return i}});
STK.register("ui.tipPrototype",function(a){var b=10003;return function(c){var d,e,f,g,h,i='<div node-type="outer" class="WB_widgets W_layer" style="position: absolute; display:none;" ><div node-type="inner" class="bg"></div></div>';d=a.parseParam({direct:"up",showCallback:a.core.func.empty,hideCallback:a.core.func.empty},c);e=a.module.layer(i,d);f=e.getOuter();g=e.getInner();e.setTipWH=function(){h=this.getSize(!0);this.tipWidth=h.w;this.tipHeight=h.h;return this};e.setTipWH();e.setContent=function(a){typeof a=="string"?g.innerHTML=a:g.appendChild(a);this.setTipWH();return this};e.setLayerXY=function(c){if(!c)throw"ui.tipPrototype need pNode as first parameter to set tip position";var e=STK.core.dom.position(c),g=e.l,h=c.offsetWidth,i=c.offsetHeight,j=Math.min(Math.max(g+(h-this.tipWidth)/2,a.scrollPos().left),a.scrollPos().left+STK.winSize().width-this.tipWidth),k=e.t;d.direct==="down"&&(k+=i);var l=[";"];l.push("z-index:",b++,";");l.push("width:",this.tipWidth,"px;");l.push("height:",this.tipHeight,"px;");l.push("top:",k,"px;");l.push("left:",j,"px;");f.style.cssText+=l.join("")};e.aniShow=function(){var b=this.getOuter();b.style.height="0px";b.style.display="";var c=a.core.ani.tween(b,{end:d.showCallback,duration:250,animationType:"easeoutcubic"});if(d.direct==="down")c.play({height:this.tipHeight},{staticStyle:"overflow:hidden;position:absolute;"});else{var e=parseInt(b.style.top,10)-this.tipHeight;c.play({height:this.tipHeight,top:Math.max(e,a.scrollPos().top)},{staticStyle:"overflow:hidden;position:absolute;"})}};e.anihide=function(){var b=this.getOuter(),c=this,e=a.core.ani.tween(b,{end:function(){b.style.display="none";b.style.height=c.tipHeight+"px";d.hideCallback()},duration:300,animationType:"easeoutcubic"});if(d.direct==="down")e.play({height:0},{staticStyle:"overflow:hidden;position:absolute;"});else{var f=parseInt(b.style.top,10)+this.tipHeight;e.play({height:0,top:f},{staticStyle:"overflow:hidden;position:absolute;"})}};document.body.appendChild(f);e.destroy=function(){document.body.removeChild(f);e=null};return e}});
STK.register("ui.tipAlert",function(a){var b=a.core.util.easyTemplate;return function(c){c=a.parseParam({direct:"up",className:"WB_widgets W_layer",showCallback:a.core.func.empty,hideCallback:a.core.func.empty,template:'<#et temp data><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div node-type="msgDiv" class="content layer_mini_info"><p class="clearfix alt_text"><span class="tip_icon WB_tipS_${data.type}"></span>${data.msg}&nbsp; &nbsp; &nbsp; </p></div></td></tr></tbody></table></#et>',type:"ok",msg:""},c);var d=a.ui.tipPrototype(c),e=d.getInner(),f=d.getOuter();f.className=c.className;e.className="bg";var g=c.template,h=a.builder(b(g,{type:c.type,msg:c.msg}).toString());d.setContent(h.box);var i=d.destroy;d.destroy=function(){i();d=null};return d}});
STK.register("common.widget.reg",function(a){var b=a.kit.extra.language,c=a.ui.tipAlert({className:"WB_tips_top",showCallback:function(){var a=c.getOuter();a.style.height="";a=null},template:'<#et temp data><div class="tips_inner"><span class="WB_tipS_warn"></span><span class="WB_icon_txt">'+b("#L{您的帐号尚未开通微博，}")+'<a href="http://weibo.com/signup/full_info.php?appsrc=6cm7D0&backurl='+encodeURIComponent(document.URL)+'&showlogo=0&vsrc=weiboshow&from=zw" target="_blank">'+b("#L{立即开通}")+"</a></span>"+"</#et>"});return function(b){if(!a.isNode(b))throw"[common.widget.reg] need node as first parameter";c.setLayerXY(b);c.aniShow();return c}});
STK.register("common.widget.addFollow",function(a){var b=a.kit.extra.language,c=function(){},d={uid:scope.loginKit().uid,url:"",fuid:"",appsrc:"",vsrc:"app_weiboshow",success:c,fail:c,btnTemp:""},e,f=function(c){if(c.fuid===c.uid){e.parentNode.innerHTML=b('<span class="WB_btnC"><span><em class="WB_btnicn_ok"></em><em>#L{你自己}</em></span></span>');return"yourself"}if(!c.url){c.url="/widget/weiboshow/aj_attention.php";/weibo.com/.test(location.host)&&(c.url="/weiboshow/aj_attention.php")}var d=c.btnTemp||'<span class="WB_btnC"><span><em class="WB_btnicn_ok"></em><em>#L{已关注}</em></span></span>';a.ajax({method:"post",url:c.url,args:{wsrc:$CONFIG.wsrc||"app_weibo_show",uid:c.uid,fuid:c.fuid},onComplete:function(g){switch(g.code){case"A00006":break;case"A10007":break;case-1:a.common.widget.reg(e);break;case-2:var h=a.common.widget.login();a.custEvent.add(h,"login",function(){c.uid=scope.loginKit().uid;f(c)});h.showLogin();break;case-3:}(g.code=="A00006"||g.code=="A10007")&&e&&(e.parentNode.innerHTML=b(d));typeof c.success=="function"&&c.success(g)},onFail:function(a){typeof c.fail=="function"&&c.fail(a)}})};return function(b,c){if(!b)throw"[common.widget.addFollow] need node as parameter";e=b;var g=function(){if(parent==self||parent==parent.parent){if(!scope.$isLogin()){var b=a.common.widget.login();a.custEvent.add(b,"login",function(){c.uid=scope.loginKit().uid;f(c)});b.showLogin();return}f(c)}},h={},i=function(){c=a.parseParam(d,c);c.fuid||(c.fuid=b.getAttribute("uid"));j()},j=function(){a.addEvent(b,"click",g)},k=function(){a.removeEvent(b,"click",g)};h.destroy=k;i();return h}});
STK.register("comp.widget.live.follow",function(a){var b=a.common.trans.live,c,d,e,f,g,h,i,j=function(){if(scope.uids.length>0){var c=b.getTrans("relations",{onComplete:function(b){var c=b.uid.length;scope.pubCount++;if(b.code==="A00006"&&c>0)for(var d=0;d<c;d++){var e=a.E("uid"+b.uid[d]);m(e)}bindDOM()}});c.request({uids:scope.uids.join(",")})}},k=function(b){var c=parseInt(a.core.dom.getStyle(e,"marginLeft"));i.play({marginLeft:c-g});return!1},l=function(b){var c=a.core.dom.getStyle(e,"marginLeft");i.play({marginLeft:c+g});return!1},m=function(b){if(!!b){var c=a.sizzle("span.liveStream_followList_action",b)[0];if(c){var d=document.createElement("span");d.className="liveStream_followList_have";d.innerHTML="<em></em";c.parentNode.replaceChild(d,c);d=null;c=null}}};return function(g){var h={},i=function(){if(!!g){k();j();n()}},k=function(){c=a.sizzle('[node-type="prevBtn"]',g)[0];d=a.sizzle('[node-type="nextBtn"]',g)[0];e=a.sizzle('[node-type="fansList"]',g)[0];var b=a.sizzle('[node-type="slider"]',g)[0];f=a.sizzle("li",e);if(f.length===0){c.style.display="none";d.style.display="none"}else a.common.diy.slider({slider:b,prev:c,next:d},{step:1,speed:1e3,show:7,auto:!1,pause:2e3,dir:"left",vertical:!1,continuous:!1,controlsFade:!0})},l=function(c,d){if(parent==self||parent==parent.parent){if(!scope.$isLogin()){var e=a.common.widget.login(),f=arguments;a.custEvent.add(e,"login",function(){l.apply(this,f)});e.showLogin();return}var g={wsrc:$CONFIG.wsrc||"app_live_stream",uid:d,login:scope.postLogin},h="aj_attention.php";scope.refer&&(g.refer=scope.refer);var i=b.getTrans("addFollow",{onComplete:function(a){a.code==="A00006"?m(c):a.msg&&alert(a.msg)}});i.request(g)}},n=function(){var b=a.sizzle('[node-type="fansList"] span.liveStream_followList_action',g),c=b.length;while(c--)a.addEvent(b[c],"click",function(c){return function(d){a.stopEvent();var e=b[c].parentNode.parentNode,f=e.getAttribute("uid");l(e,f)}}(c))},o=function(){};i();h.destroy=o;return h}});
STK.register("common.diy.hover",function(a){return function(b,c,d){var e=b.className,f=b.style.cssText;a.addEvent(b,"mouseover",function(){c(b)});!d||typeof d!="function"?a.addEvent(b,"mouseout",function(){b.className=e;b.style.cssText=f}):a.addEvent(b,"mouseout",function(){d(b)})}});
STK.register("comp.widget.live.slidedown",function(a){var b=a.common.diy.hover;return function(c,d){a.isNode(c)||(c=a.E(c));var e=c.offsetHeight;c.style.height="0";c.style.overflow="hidden";c.style.display="";var f=function(){c.style.overflow="";c.style.height="";g.destroy();typeof d=="function"&&d()},g=STK.core.ani.tween(c,{end:f});g.play({height:e});b(c,function(a){a.className="liveStream_mainFeed_list liveStream_mainFeed_list_focus clearfix"},function(a){a.className="liveStream_mainFeed_list clearfix"})}});
if(typeof scope=="undefined")var scope={};scope.refer_content||(scope.refer_content="");scope.pubCount=0;STK.register("comp.widget.live.init",function(a){function r(b){var c=a.core.dom.next(b);c&&a.removeNode(c)}var b=a.addEvent,c=a.getEvent,d=a.trim,e=a.reomveEvent,f=a.sizzle,g=a.ajax,h=a.fireEvent,i=a.stopEvent,j=a.kit.extra.language,k=a.common.editor.getLength,l=a.common.editor.flashContent,m=a.common.trans.live,n=2e3,o,p;scope.delMids=[];var q=function(){if(!!o){o.value="#"+decodeURIComponent(scope.puptopic)+"#";a.fireEvent(o,"keyup")}},s=function(b){b=b.box;r(o);a.insertAfter(b,o);setTimeout(function(){r(o)},2e3)},t=function(){var b=a.builder(j('<p class="commentInput_state"><span class="WB_tipS_ok commentInput_state_icon"></span>#L{发布成功}</p>'));s(b)},u=function(b){b=b||"#L{发表微博失败}";var c=a.builder(j('<p class="commentInput_state"><span class="WB_tipS_err commentInput_state_icon"></span>'+b+'<a href="###" node-type="backBtn">#L{返回}</a></p>'));a.addEvent(c.list.backBtn,"click",function(){c.style.display="none";return!1});s(c)},v=function(){var b=a.trim(o.value),c=k(b);if(c>n||c==0)l(o);else{if(!scope.loginKit().isLogin){var d=a.common.widget.login({vsrc:"app_livestream",appsrc:scope.appsrc});a.custEvent.add(d,"login",function(){v()});d.showLogin()}if(p==!0)return;p=!0;b+=scope.refer_content;var e={appkey:scope.appkey,refer:scope.refer,language:scope.$language,url_param:scope.url_param,content:encodeURIComponent(b)};tran=m.getTrans("addmblog",{onComplete:function(b){if(b.code==="A00006"){if(b.html){var c=document.createElement("DIV");c.innerHTML=b.html;var d=a.sizzle(".liveStream_mainFeed_list",c)[0],e=a.sizzle('[node-type="box"]',a.E("live_content"))[0];e.insertBefore(d,e.firstChild);a.comp.widget.live.slidedown(d)}b.delmid&&scope.delMids.push(b.delmid);q();t()}else u(b.msg);p=null},onError:function(){p=null},onFail:function(){p=null}});tran.request(e);return!1}},w=a.C("div");w.className=" WB_widgets WB_widgets_layer_picshow";var x=function(b){var c=b.el,d=b.data.src,e=new Image;e.onload=function(){var b=a.E("live_content").offsetWidth,d=a.position(c),f=d.l;parseInt(f+e.width)>b&&(f=b-e.width-2);w.style.left=f+"px";w.style.top=d.t+c.offsetHeight+2+"px";w.style.display="block"};e.src=d;w.appendChild(e)},y=function(){w.style.display="none";w.innerHTML=""};return function(b,c){var d={},e,f=function(){var a=new Image,b="http://rs.sinajs.cn/tmp.gif?";b+="id=live&action=pv";b+="&uid="+($CONFIG.$uid||0);b+="&url="+encodeURIComponent(document.referrer);b+="&r="+(new Date).valueOf();a.src=b},g=function(){h();b.appendChild(w);e=a.comp.widget.live.repost_comm(a.E("live_content"));a.comp.widget.live.follow(a.E("pl_live_fans"));a.comp.widget.live.style();n-=k(scope.refer_content==""?"":" "+scope.refer_content);a.comp.widget.live.loadmore();f()},h=function(){o=a.sizzle('[node-type="editor"]',a.E("publisher"))[0];q();a.E("publisher")&&a.common.editor.simpleEditorNew(a.E("publisher"),{limit:n,warnClassName:"txt_num err_num",className:"txt_num"});var c=a.sizzle('div[node-type="box"]',b),d=a.E("tabs"),e=a.sizzle("li",d);c.length>1&&e.length>1&&a.module.tabs(d,{tabNode:"li",boxNode:c,callback:function(){}});a.addEvent(a.E("publisherBtn"),"click",v);a.core.evt.hotKey.add(o,"ctrl+Enter",v);var f=a.delegatedEvent(b);f.add("showpic","mouseover",x);f.add("showpic","mouseout",y)},i=function(){a.removeEvent(a.E("publisherBtn"),"click",v);a.core.evt.hotKey.remove(o,"ctrl+Enter",v);e.destroy()};g();d.destroy=i;return d}});
STK.pageletM.register("pl.widget.live",function(a){try{var b={},c=a.E("pl_live"),d=a.comp.widget.live.init(c,b);return d}catch(e){}});
STK.pageletM.start();
